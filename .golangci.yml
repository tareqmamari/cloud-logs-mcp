# golangci-lint configuration
# https://golangci-lint.run/usage/configuration/

run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly

output:
  formats:
    - format: colored-line-number
  print-issued-lines: true
  print-linter-name: true
  sort-results: true

linters:
  enable:
    - errcheck       # Check for unchecked errors
    - gosimple       # Simplify code
    - govet          # Reports suspicious constructs
    - ineffassign    # Detects ineffectual assignments
    - staticcheck    # Static analysis
    - typecheck      # Type checks
    - unused         # Checks for unused constants, variables, functions
    - gofmt          # Checks if code was gofmt-ed
    - goimports      # Checks import statements are formatted
    - misspell       # Finds commonly misspelled words
    - gocritic       # Provides diagnostics
    - gosec          # Security checker
    - revive         # Fast, configurable, extensible linter
    - unconvert      # Removes unnecessary type conversions
    - unparam        # Reports unused function parameters
    - gocyclo        # Computes cyclomatic complexity
    - dupl           # Code clone detection
    - goconst        # Finds repeated strings
    - godot          # Checks if comments end in a period
    - lll            # Reports long lines
    - gci            # Controls Go package import order
    - bodyclose      # Checks HTTP response bodies are closed
    - noctx          # Finds HTTP requests without context
    - rowserrcheck   # Checks SQL rows.Err is checked
    - sqlclosecheck  # Checks SQL Close() is called
    - wastedassign   # Finds wasted assignment statements

linters-settings:
  errcheck:
    check-type-assertions: true
    check-blank: true

  govet:
    enable-all: true
    disable:
      - shadow

  gofmt:
    simplify: true

  goimports:
    local-prefixes: github.com/observability-c/logs-mcp-server

  misspell:
    locale: US

  gocritic:
    enabled-tags:
      - diagnostic
      - style
      - performance
      - experimental
      - opinionated

  gosec:
    excludes:
      - G104  # Audit errors not checked (covered by errcheck)
      - G304  # File path provided as taint input (needed for dynamic config)
    severity: medium
    confidence: medium

  revive:
    rules:
      - name: exported
        arguments:
          - checkPrivateReceivers
          - sayRepetitiveInsteadOfStutters

  gocyclo:
    min-complexity: 15

  dupl:
    threshold: 100

  goconst:
    min-len: 3
    min-occurrences: 3

  lll:
    line-length: 120
    tab-width: 4

  gci:
    sections:
      - standard
      - default
      - prefix(github.com/observability-c/logs-mcp-server)

issues:
  exclude-rules:
    # Exclude some linters from running on tests files
    - path: _test\.go
      linters:
        - gocyclo
        - errcheck
        - dupl
        - gosec
        - goconst

    # Exclude lll issues for long lines with go:generate
    - linters:
        - lll
      source: "^//go:generate "

  max-issues-per-linter: 0
  max-same-issues: 0
  new: false

severity:
  default-severity: warning
  rules:
    - linters:
        - gosec
        - govet
      severity: error
